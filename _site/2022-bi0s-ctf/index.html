<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>2022 Bi0s Ctf</title><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.4" />
<meta property="og:title" content="2022 Bi0s Ctf" />
<meta name="author" content="김민순" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Wonder Why" />
<meta property="og:description" content="Wonder Why" />
<link rel="canonical" href="http://localhost:4000/2022-bi0s-ctf/" />
<meta property="og:url" content="http://localhost:4000/2022-bi0s-ctf/" />
<meta property="og:site_name" content="I’m such a good surfer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-23T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="2022 Bi0s Ctf" />
<script type="application/ld+json">
{"description":"Wonder Why","url":"http://localhost:4000/2022-bi0s-ctf/","@type":"BlogPosting","headline":"2022 Bi0s Ctf","dateModified":"2023-01-23T00:00:00+09:00","datePublished":"2023-01-23T00:00:00+09:00","author":{"@type":"Person","name":"김민순"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022-bi0s-ctf/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="I&apos;m such a good surfer" /><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>


<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

  <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
  <link rel="stylesheet" href="/assets/css/main.css" />
</head>
<body a="dark">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">cd ..</a><article>
  <p class="post-meta">
    <font size="2em">soon_haari</font>
    <time datetime="2023-01-23 00:00:00 +0900">2023-01-23</time>
  </p>
  
  <h1>2022 Bi0s Ctf</h1>

  <p><br /><br /></p>

<p>This weekend, I played multiple CTFs including</p>

<p>KnightCTF, Insomnihack, bi0sCTF.</p>

<p><br /></p>

<p>KnightCTF challenges weren’t so hard / high quality, so I just cleared 7 crypto challs, which required extremely low level knowledge about crypto, and stopped playing.</p>

<p><br /></p>

<p>For Insomnihack, I was given a very few time to play, since my team was not really focusing on it, and was planning to focus on bi0sCTF which starts 3 hour later.</p>

<p>Despite, I was glad that I solved one crypto chall about GCM mode in AES.</p>

<p><br /></p>

<p>Now about bi0sCTF, my team ‘thehackerscrew’ gladly finished top 1. I solved only 2 crypto challenges out of 4. Something worth remembering for me is that I first-blooded both challs.</p>

<p>But it was not very twisted challenge anyway, just honest challs which easily shows the path to solving them. I wished that I could solve one more challenge called too-ec, but wasn’t so familiar with the method.</p>

<p><br /><br /></p>

<h2 id="leaky-dsa"><strong>leaky-dsa</strong></h2>

<h3 id="challsage"><strong>chall.sage</strong></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">flag</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>

<span class="n">p</span> <span class="o">=</span> <span class="mh">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span>
<span class="n">a</span> <span class="o">=</span> <span class="mh">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span>
<span class="n">b</span> <span class="o">=</span> <span class="mh">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span>

<span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">gens</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">G</span><span class="p">.</span><span class="n">order</span><span class="p">()</span>
<span class="n">priv</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">).</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">nbits</span><span class="p">()</span><span class="o">//</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'big'</span><span class="p">)</span> <span class="o">+</span> <span class="n">sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">).</span><span class="n">digest</span><span class="p">()).</span><span class="n">digest</span><span class="p">(),</span> <span class="s">'big'</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="n">msg</span><span class="p">).</span><span class="n">digest</span><span class="p">(),</span><span class="s">'big'</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">k</span> <span class="o">*</span> <span class="n">G</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="n">q</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">inverse_mod</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">%</span> <span class="n">q</span>
    <span class="n">leak_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">120</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">120</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">leak_k</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter message: "</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">priv</span><span class="p">))</span>
</code></pre></div></div>

<p><br /></p>

<p>It was an ecdsa challenge that gives upper bits of k.</p>

<p>Giving upper bits of k means that the unknown value is in a small range, and can perform a famous LLL attack.</p>

<p><br /></p>

<p>Coppersmith works too, but I referenced this article: <a href="https://eprint.iacr.org/2019/023.pdf">https://eprint.iacr.org/2019/023.pdf</a></p>

<p>Implementation is not much hard.</p>

<p>There was no limit of number for allowed data, so I just chose 10.</p>

<h3 id="exsage"><strong>ex.sage</strong></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">p</span> <span class="o">=</span> <span class="mh">0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff</span>
<span class="n">a</span> <span class="o">=</span> <span class="mh">0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc</span>
<span class="n">b</span> <span class="o">=</span> <span class="mh">0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b</span>

<span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">gens</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">G</span><span class="p">.</span><span class="n">order</span><span class="p">()</span>



<span class="n">num_data</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">t_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">a_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">B_</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">120</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_data</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"crypto.chall.bi0s.in"</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter message: "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">", "</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

    <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">leak_k</span> <span class="o">=</span> <span class="n">data</span>

    <span class="n">t_list</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">a_list</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">z</span> <span class="o">/</span> <span class="n">s</span> <span class="o">+</span> <span class="n">leak_k</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter message: "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">", "</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

    <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">leak_k</span> <span class="o">=</span> <span class="n">data</span>

    <span class="n">t_list</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">a_list</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="o">-</span><span class="n">z</span> <span class="o">/</span> <span class="n">s</span> <span class="o">+</span> <span class="n">leak_k</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span>

    <span class="n">io</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"done"</span><span class="p">)</span>

<span class="n">mat</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_data</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_data</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
    <span class="n">mat</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">t_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">B_</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span>
<span class="n">t_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">a_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">a_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">B_</span><span class="p">)</span>
<span class="n">mat</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_list</span><span class="p">)</span>
<span class="n">mat</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">mat</span><span class="p">).</span><span class="n">LLL</span><span class="p">()</span>

<span class="n">ks</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="n">ks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">t_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">%</span> <span class="n">q</span>

<span class="k">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</code></pre></div></div>

<p><br /><br /></p>

<h2 id="bad2code"><strong>bad2code</strong></h2>

<h3 id="challsage-1"><strong>chall.sage</strong></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">secrets</span> <span class="kn">import</span> <span class="n">FLAG</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span> <span class="o">==</span> <span class="mi">44</span>
<span class="n">FLAG_FORMAT</span> <span class="o">=</span> <span class="s">"bi0s"</span>

<span class="n">NBITS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">2</span>

<span class="n">a</span> <span class="o">=</span> <span class="mh">0xBAD2C0DE</span>
<span class="n">c</span> <span class="o">=</span> <span class="mh">0x6969</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">NBITS</span>
<span class="n">seed</span> <span class="o">=</span> <span class="n">getRandomNBitInteger</span><span class="p">(</span><span class="n">NBITS</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">seed</span>

<span class="n">ciphertext</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FLAG</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">%</span><span class="n">m</span>
    <span class="n">ciphertext</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">state</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">NBITS</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">))</span><span class="o">^^</span><span class="n">i</span><span class="o">^^</span><span class="nb">ord</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">public</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">91</span><span class="p">):</span>
    <span class="n">public</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">public</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">public</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">getRandomInteger</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">GCD</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">*</span><span class="n">i</span> <span class="o">%</span> <span class="n">q</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">public</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">ct</span><span class="p">):</span>
    <span class="n">blen</span> <span class="o">=</span> <span class="n">ct</span><span class="p">.</span><span class="n">bit_length</span><span class="p">()</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">ct</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ct</span><span class="p">]</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ct</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">blen</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>

<span class="n">ct</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ciphertext</span><span class="p">:</span>
    <span class="n">ct</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">encrypt</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"ct.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="c1"># r = 439336960671443073145803863477
</span></code></pre></div></div>

<p>I think the author wanted us to use LLL to get the binary values that are multipled to r*factorials, but since they gave the r value already, by multiplying r’s inverse to the final number, it isn’t really needed.</p>

<p>Also sum of 0 ~ k th factorial is always smaller than k + 1 th factorial, so we can easily get the binary values and numbers.</p>

<p><br /></p>

<p>The next step was finding the initial state from the known values.</p>

<p>With all the flag format infos, we theoretically could get significant half bits of 8 front values.</p>

<p><br /></p>

<p>Getting the lower bits is the problem here.</p>

<p>The LCG is generated by multiplying 0xBAD2C0DE and adding 0x6969 every step.</p>

<p>With $k$th state’s upper bits and $k + 1$th state’s upper bits,</p>

<p>we can reveal the top of unknown bits of $k$th state.</p>

<p>This is pretty obvious because to match $a*state + k$’s higher bits, state’s lower half bits get to affect them.</p>

<p><del>(This is pretty nasty to read… I will learn LaTeX soon..)</del></p>

<p>(Gladly I learnt it now!!!!!!UwU)
<br /><br /></p>

<p>So we can reveal around $a$’s bit_length every step. It is around 30 bits, but I chose to reveal 22 bits everytime just to be safe.</p>

<h3 id="exsage-1"><strong>ex.sage</strong></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pubkey</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">91</span><span class="p">):</span>
    <span class="n">pubkey</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">pubkey</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pubkey</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">redacted</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">439336960671443073145803863477</span>

<span class="n">datas</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">44</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span> <span class="o">%</span> <span class="n">q</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">pubkey</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">j</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">-=</span> <span class="n">pubkey</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">j</span>

    <span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">datas</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="mh">0xBAD2C0DE</span>
<span class="n">c</span> <span class="o">=</span> <span class="mh">0x6969</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">176</span>
<span class="n">flag_f</span> <span class="o">=</span> <span class="s">"bi0sc"</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">samples</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">datas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^^</span> <span class="n">i</span> <span class="o">^^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">flag_f</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;&lt;</span> <span class="mi">88</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">low_range</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">high_range</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">22</span> <span class="o">*</span> <span class="n">i</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">add_low</span> <span class="o">=</span> <span class="p">(</span><span class="n">low_range</span> <span class="o">-</span> <span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span> <span class="o">//</span> <span class="n">a</span>
    <span class="n">add_high</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_range</span> <span class="o">-</span> <span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span> <span class="o">//</span> <span class="n">a</span>

    <span class="k">print</span><span class="p">(</span><span class="n">add_low</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">add_high</span><span class="p">)</span>

    <span class="c1">#assert add_low &gt;&gt; (22 * (i - 1)) == add_high &gt;&gt; (22 * (i - 1))
</span>    <span class="n">add</span> <span class="o">=</span> <span class="p">(</span><span class="n">add_low</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">22</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">22</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">samples</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">add</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"done"</span><span class="p">)</span>
<span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(((</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">((</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">%</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span> <span class="o">==</span> <span class="n">samples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span>


<span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">43</span><span class="p">):</span>
    <span class="n">states</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">44</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">88</span><span class="p">)</span> <span class="o">^^</span> <span class="n">datas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^^</span> <span class="n">i</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</code></pre></div></div>

<p><br /><br /></p>

<h2 id="unsolved-too-ec"><strong>Unsolved: too-ec</strong></h2>

<p>This was a challenge that we should get the value of 3 chunks that are redacted from p.</p>

<p>p was 512 bit length, and 3 chunks were 36, 40, 40 bit length, so the given bits were enough.</p>

<p><br /></p>

<p>The problem was that those chunks weren’t continuous, so we have to use multi-variabled coppersmith.</p>

<p>Thankfully my teammate kiona provided me a comparison from ConnorM, of 4 different method for this. <a href="https://gist.github.com/Connor-McCartney/f107d91dea14a04e24db44090dee40de">https://gist.github.com/Connor-McCartney/f107d91dea14a04e24db44090dee40de</a></p>

<p><br /></p>

<p>Sadly, since it was a simple implementation of the original ones, none of the method seemed to work with 3 variables.</p>

<p>After the CTF ended, I found the author and mant solvers have used joseph’s implementation to solve this.</p>

<p><a href="https://github.com/josephsurin/lattice-based-cryptanalysis/blob/main/lbc_toolkit/problems/small_roots.sage">https://github.com/josephsurin/lattice-based-cryptanalysis/blob/main/lbc_toolkit/problems/small_roots.sage</a></p>

<p><br /></p>

<p>Extreme respect for joseph, and 3 other authors of implementations also.</p>

<p><br /></p>

<p>After recovering p1 with coppersmith, structing the curve and getting the order, and finally getting the hidden value of ecdsa is same as <strong>leaky-dsa</strong>.</p>

<p><br /><br /></p>

<h2 id="-misc-snek-game"><strong>+ misc: Snek Game</strong></h2>

<table>
  <tbody>
    <tr>
      <td><img src="../files/bi0s_ctf/snek.png" width="250" height="250" /></td>
      <td><img src="../files/bi0s_ctf/snek1.png" width="250" height="250" /></td>
    </tr>
  </tbody>
</table>

<p>For this challenge, after CSN3RD explained about the challenge, I came up with some ideas that could make this work. Gladly, he understood it very well and did a great job on implementing it. GG!</p>

</article>


      </div>
    </main>
  </body>
</html>